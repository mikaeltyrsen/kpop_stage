<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DMX Template Builder</title>
    <link rel="stylesheet" href="builder.css" />
  </head>
  <body>
    <header class="builder-header">
      <div class="builder-header__content">
        <h1>DMX Template Builder</h1>
        <p>Create and edit lighting cues that sync with your show videos.</p>
      </div>
    </header>

    <nav class="builder-tabs" role="tablist">
      <button
        type="button"
        class="builder-tab is-active"
        role="tab"
        aria-selected="true"
        data-tab="timeline"
      >
        Timeline
      </button>
      <button
        type="button"
        class="builder-tab"
        role="tab"
        aria-selected="false"
        data-tab="presets"
      >
        Channel Presets
      </button>
      <button
        type="button"
        class="builder-tab"
        role="tab"
        aria-selected="false"
        data-tab="colors"
      >
        Color Presets
      </button>
      <button
        type="button"
        class="builder-tab"
        role="tab"
        aria-selected="false"
        data-tab="templates"
      >
        Light Templates
      </button>
    </nav>

    <section id="timeline-panel" class="tab-panel" data-tab-panel="timeline">
      <section class="builder-controls">
        <label class="control-group" for="video-select">
          <span class="control-label">Song</span>
          <select id="video-select">
            <option value="">Select a song…</option>
          </select>
        </label>
        <button id="add-step" type="button" class="control-button" disabled>
          Add Step
        </button>
        <button id="save-template" type="button" class="primary" disabled>
          Save Template
        </button>
        <button id="export-template" type="button" class="secondary" disabled>
          Export JSON
        </button>
        <div class="system-actions">
          <button id="system-update" type="button" class="secondary">
            Update &amp; Restart
          </button>
          <button id="system-restart" type="button" class="secondary">
            Restart Pi
          </button>
          <button id="system-shutdown" type="button" class="secondary">
            Shutdown Pi
          </button>
        </div>
        <span id="status-message" role="status" aria-live="polite"></span>
      </section>

      <section class="template-info" id="template-info" hidden></section>

      <div id="timeline-empty-state" class="timeline-empty" hidden>
        <p>Select a song to start building a timeline.</p>
      </div>

      <main class="builder-layout" hidden aria-hidden="true">
        <section class="preview-panel">
          <h2>Video Preview</h2>
          <video id="preview-video" controls preload="metadata"></video>
          <section
            id="stage-visualizer"
            class="stage-visualizer"
            aria-live="polite"
            aria-label="Lighting preview"
          >
            <div class="stage-wrapper">
              <div class="stage">
                <div class="stage-floor"></div>

                <div id="light-bar-1" class="light-bar">
                  <div class="white-color"></div>
                </div>

                <div id="light-bar-2" class="light-bar">
                  <div class="white-color"></div>
                </div>

                <div id="light-bar-3" class="light-bar">
                  <div class="white-color"></div>
                </div>

                <div id="light-bar-4" class="light-bar">
                  <div class="white-color"></div>
                </div>

                <div id="mover-light">
                  <div id="red-laser" class="laser"><img src="./red_laser.png" alt="" /></div>
                  <div id="green-laser" class="laser"><img src="./green_laser.png" alt="" /></div>
                  <div id="beam-1" class="beam"><div class="white-color"></div></div>
                  <div id="beam-2" class="beam"><div class="white-color"></div></div>
                  <div id="beam-3" class="beam"><div class="white-color"></div></div>
                  <div id="beam-4" class="beam"><div class="white-color"></div></div>
                  <div id="led-strip"></div>
                </div>
              </div>
            </div>
            <p class="stage-status">All fixtures at blackout.</p>
          </section>
          <div class="video-hints">
            <p>
              Select a row in the timeline to jump to that cue. The time input keeps the
              video preview aligned with the cue you are editing.
            </p>
          </div>
        </section>

        <section class="table-panel">
          <header class="table-panel__header">
            <h2>Lighting Steps</h2>
            <div class="channel-filter" id="channel-filter">
              <button
                type="button"
                id="channel-filter-button"
                class="channel-filter__button"
                aria-haspopup="true"
                aria-expanded="false"
                aria-controls="channel-filter-dropdown"
              >
                <span class="channel-filter__button-label">Filter Channels</span>
                <span id="channel-filter-count" class="channel-filter__button-count" hidden></span>
                <span class="channel-filter__chevron" aria-hidden="true">▾</span>
              </button>
              <div
                id="channel-filter-dropdown"
                class="channel-filter__dropdown"
                role="menu"
                aria-label="Filter timeline by channel preset"
                hidden
                aria-hidden="true"
              >
                <div class="channel-filter__header">
                  <span class="channel-filter__title">Channel Presets</span>
                  <button type="button" id="channel-filter-clear" class="channel-filter__clear" disabled>
                    Clear
                  </button>
                </div>
                <div
                  id="channel-filter-groups"
                  class="channel-filter__groups"
                  role="group"
                  aria-label="Channel preset groups"
                ></div>
              </div>
            </div>
          </header>
          <div class="table-wrapper">
            <div class="actions-grid" role="grid" aria-label="Lighting steps timeline">
              <div class="actions-grid__header" role="row">
                <span
                  class="actions-grid__cell actions-grid__cell--handle actions-grid__header-cell"
                  role="columnheader"
                >
                  <span class="visually-hidden">Reorder</span>
                </span>
                <div class="actions-grid__cell actions-grid__cell-group actions-grid__header-group" role="presentation">
                  <span class="actions-grid__cell actions-grid__header-cell" role="columnheader">
                    Channel
                  </span>
                  <span class="actions-grid__cell actions-grid__header-cell" role="columnheader">
                    Value
                  </span>
                  <span class="actions-grid__cell actions-grid__header-cell" role="columnheader">
                    Fade (s)
                  </span>
                </div>
                <span class="actions-grid__cell actions-grid__header-cell" role="columnheader">
                  Tools
                </span>
              </div>
              <div id="actions-body" class="actions-grid__body" role="rowgroup"></div>
            </div>
          </div>
        </section>
      </main>
    </section>

    <section
      id="presets-panel"
      class="preset-settings tab-panel"
      data-tab-panel="presets"
      aria-labelledby="channel-presets-heading"
      hidden
      aria-hidden="true"
    >
      <header class="preset-settings__header">
        <div>
          <h2 id="channel-presets-heading">Channel Presets</h2>
          <p>
            Create friendly names for your fixtures and their common values.
            These presets appear in the channel and value dropdowns when you
            build cues.
          </p>
        </div>
        <div class="preset-settings__actions">
          <button id="add-channel-preset" type="button" class="secondary">
            Add Channel Preset
          </button>
        </div>
      </header>
      <div id="channel-presets" class="preset-settings__list" aria-live="polite"></div>
    </section>

    <section
      id="color-presets-panel"
      class="color-settings tab-panel"
      data-tab-panel="colors"
      aria-labelledby="color-presets-heading"
      hidden
      aria-hidden="true"
    >
      <header class="color-settings__header">
        <div>
          <h2 id="color-presets-heading">Color Presets</h2>
          <p>
            Configure the quick select swatches for master controls, including their
            display color and DMX RGB values.
          </p>
        </div>
        <div class="color-settings__actions">
          <button id="add-color-preset" type="button" class="secondary">
            Add Color Preset
          </button>
          <button id="reset-color-presets" type="button" class="secondary">
            Reset to Defaults
          </button>
        </div>
      </header>
      <div id="color-presets" class="color-settings__list" aria-live="polite"></div>
    </section>

    <section
      id="templates-panel"
      class="template-library tab-panel"
      data-tab-panel="templates"
      hidden
      aria-hidden="true"
    >
      <header class="template-library__header">
        <div>
          <h2>Light Templates</h2>
          <p>
            Assemble reusable channel combinations that you can drop into any
            step. Templates don’t include a timestamp so they work anywhere in
            your timeline.
          </p>
        </div>
        <div class="template-library__actions">
          <button id="add-light-template" type="button" class="primary">
            New Template
          </button>
        </div>
      </header>
      <div class="template-library__split">
        <aside class="template-library__sidebar" aria-live="polite">
          <h3 class="visually-hidden">Template list</h3>
          <div class="template-library__filter">
            <label class="visually-hidden" for="light-template-filter">Filter templates</label>
            <input
              type="search"
              id="light-template-filter"
              placeholder="Filter templates…"
              autocomplete="off"
              spellcheck="false"
            />
          </div>
          <ul id="light-templates" class="template-list" role="list"></ul>
        </aside>
        <section id="template-detail" class="template-detail" aria-live="polite"></section>
      </div>
    </section>

    <template id="action-row-template">
      <div class="actions-grid__row action-group-item" role="row">
        <div class="actions-grid__cell actions-grid__cell--handle" data-column="handle"></div>
        <div class="actions-grid__cell actions-grid__cell-group" data-column-group="fields">
          <div class="actions-grid__cell" data-column="channel"></div>
          <div class="actions-grid__cell" data-column="value"></div>
          <div class="actions-grid__cell actions-grid__cell--fade" data-column="fade"></div>
        </div>
        <div class="actions-grid__cell actions-grid__cell--tools" data-column="tools"></div>
      </div>
    </template>

    <div id="template-picker" class="template-picker" hidden aria-hidden="true">
      <div class="template-picker__backdrop" data-template-picker-close></div>
      <div class="template-picker__dialog" role="dialog" aria-modal="true" aria-labelledby="template-picker-title">
        <header class="template-picker__header">
          <h2 id="template-picker-title">Add Template to Step</h2>
          <button type="button" class="template-picker__close" data-template-picker-close>
            <span aria-hidden="true">×</span>
            <span class="visually-hidden">Close</span>
          </button>
        </header>
        <div class="template-picker__body">
          <label class="template-picker__search">
            <span class="visually-hidden">Search templates</span>
            <input
              type="search"
              id="template-picker-search"
              placeholder="Search templates…"
              autocomplete="off"
            />
          </label>
          <ul id="template-picker-results" class="template-picker__results" role="listbox" aria-live="polite"></ul>
        </div>
      </div>
    </div>

    <template id="template-row-template">
      <tr>
        <td data-template-column="handle"></td>
        <td data-template-column="channel"></td>
        <td data-template-column="value"></td>
        <td data-template-column="fade"></td>
        <td data-template-column="tools"></td>
      </tr>
    </template>
  
    <script src="builder.js" type="module"></script>
  </body>
</html>
